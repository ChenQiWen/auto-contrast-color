<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Auto Contrast Color (ESM)</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .color-container {
            width: 300px;
            height: 150px;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            box-sizing: border-box; /* 包含 padding 和 border */
            transition: background-color 0.3s ease, color 0.3s ease; /* 平滑过渡 */
            font-size: 1.2em;
            font-weight: bold;
        }
        label {
            margin-top: 15px;
            font-weight: bold;
        }
        input[type="color"] {
            margin-left: 10px;
            width: 50px;
            height: 30px;
            vertical-align: middle;
        }
        p {
            margin-top: 15px;
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>
<body>

    <h1>Auto Contrast Color Test (ESM)</h1>

    <label for="bgColorPicker">Choose Background Color:</label>
    <input type="color" id="bgColorPicker" value="#FFFFFF">

    <div id="colorDisplay" class="color-container">
        This text color should adapt to the background for good contrast.
    </div>

    <p>Current Text Color: <code id="textColorValue">#000000</code></p>

    <!-- 使用 type="module" 并通过 import 引入 -->
    <script type="module">
        // 从构建好的 ESM 文件导入默认导出的函数
        // 确保路径相对于 HTML 文件是正确的
        import getContrastTextColor from './dist/browser/auto-contrast-color.esm.js';

        const bgColorPicker = document.getElementById('bgColorPicker');
        const colorDisplay = document.getElementById('colorDisplay');
        const textColorValue = document.getElementById('textColorValue');

        // Function to display error messages in the UI
        function displayErrorState(message = 'Error occurred.') {
            colorDisplay.textContent = message;
            colorDisplay.style.color = '#FF0000'; // Red text for error
            colorDisplay.style.backgroundColor = '#F0F0F0'; // Light grey background
            textColorValue.textContent = 'Error';
        }

        // Function to update colors based on picker value
        function updateColor() {
            const bgColor = bgColorPicker.value;
            console.log(`Color picker changed to: ${bgColor}`);
            colorDisplay.style.backgroundColor = bgColor;

            try {
                // 直接调用导入的函数
                const contrastColor = getContrastTextColor(bgColor);
                console.log(`Calculated contrast color: ${contrastColor}`);

                // Reset text content if it was showing an error
                 if (colorDisplay.textContent !== 'This text color should adapt to the background for good contrast.') {
                      colorDisplay.textContent = 'This text color should adapt to the background for good contrast.';
                 }
                colorDisplay.style.color = contrastColor;
                textColorValue.textContent = contrastColor;

            } catch (error) {
                console.error('Error executing getContrastTextColor:', error);
                // 检查是否是 tinycolor 的无效颜色错误
                if (error.message && error.message.includes('Invalid Color')) {
                     displayErrorState(`Invalid color input: ${bgColor}`);
                } else {
                    displayErrorState(`Error calculating color for ${bgColor}.`);
                }
            }
        }

        // 初始化时执行一次
        // 对于 module script，DOM 解析完成后才会执行，所以 DOMContentLoaded 不需要
        console.log('Module script executing. Attempting initial color update...');
        // 初始调用前检查函数是否真的导入成功 (虽然 import 失败会直接抛错)
        if (typeof getContrastTextColor === 'function') {
             updateColor();
        } else {
             // 这种情况理论上不会发生，因为 import 失败会阻止脚本执行到这里
             console.error("Critical Error: getContrastTextColor function was not imported correctly.");
             displayErrorState("Failed to load the library function.");
        }


        // 监听颜色选择器的变化
        bgColorPicker.addEventListener('input', updateColor);

    </script>

</body>
</html> 